<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta http-equiv="X-UA-Compatible" content="ie=edge" />
	<link rel="stylesheet" href="css/bootstrap.min.css"
		integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous" />
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
	<script src="scripts/jquery-3.4.1.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
		integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
		crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
		integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
		crossorigin="anonymous"></script>
	<title>Document</title>
	<style>
		body {
			text-align: center;
			background-attachment: fixed;
			background-image: linear-gradient(#9e9e9e, var(--dark));
		}

		.register-form {
			width: 300px;
			margin: 0 auto;
		}

		.icon_digital {
			color: indigo;
			margin: 5px;
		}
		.alert-box {
			margin-top: 25px;
		}
	</style>

	<script>
		$(function () {
			$(".update-finger").click(event => {
				if(!$("input[name=id]").val()) {
					showError('danger', "Informe um ID antes de inserir a digital");
					return;
				}
				$.post("http://localhost/api/abrircadastro/" + $("input[name=id]").val(),
					"json"
				).done(data => {
					console.log(data);
				});
			});
			$(".cad").click(event => {
				$.post(
					"http://localhost/api/registrar/" +
					$("input[name=id]").val() +
					"/" +
					$("input[name=name]").val() +
					"/" +
					$("input[name=ra]").val(),
					"json"
				)
					.done(data => {
						console.log(data);
					})
					.fail(data => {
						console.log(data);
					});
			});
			$(".alt").click(event => {
				$.ajax({
					url:
						"http://localhost/api/cadastro/" +
						$("input[name=id]").val() +
						"?name=" +
						$("input[name=name]").val() +
						"&RA=" +
						$("input[name=ra]").val(),
					method: "PUT"
				})
					.done(data => {
						showError('success', "Cadastro alterado");
						console.log(data);
					})
					.fail(data => {
						showError('danger', 'Falha ao alterar o cadastro');
						console.log(data);
					});
			});

			$("input[name=id]").keyup(event => {
				if (!$("input[name=id]").val()) {
					$(".alt").attr("disabled", "disabled");
					$(".cad").attr("disabled", "disabled");
					return;
				}

				$.get(
					"http://localhost/api/cadastros/" + $("input[name=id]").val(),
					"json"
				)
					.done(data => {
						$("input[name=name]").val(data.name);
						$("input[name=ra]").val(data.ra);
						$(".alt").removeAttr("disabled");
						$(".cad").attr("disabled", "disabled");
					})
					.fail(data => {
						showError('danger', "Cadastro nÃ£o encontrado");
						console.log("cadastro nao existe");
						$("input[name=name]").val("");
						$("input[name=ra]").val("");
						$(".alt").attr("disabled", "disabled");
						$(".cad").removeAttr("disabled");
					});
			});
		});
		function showError(alertType, msg){
			const alert = $(".alert");
			let classToAdd;
			alert.show();
			if(alertType === 'danger'){
				classToAdd = 'alert-danger';
			} else if(alertType === 'success') {
				classToAdd = 'alert-success';
			}
			alert.addClass(classToAdd)
			alert.text(msg);
				setTimeout(() => {
					alert.removeClass(classToAdd);
					alert.hide();
				}, 3000);
		}
	</script>
</head>

<body>
	<h1>
		<img src="http://uniamerica.br/wp-content/uploads/2014/11/logo-1.png" />
	</h1>
	<h2 style="color:#585858">Painel Admistrativo</h2>
	<div class="register-form">

		<div class="input-group mb-3" id="input-error" >
			<input type="number" class="form-control" name="id" placeholder="Informe um ID"
				aria-label="Informe um ID para dastrar um novo usuario" aria-describedby="basic-addon1" />
			<div class="icon_digital">
				<a href="#" class="update-finger"><i class="material-icons">touch_app</i></a>
			</div>
		</div>

		<div class="input-group mb-3">
			<input type="text" class="form-control" name="name" placeholder="Nome completo" aria-label="Nome completo"
				aria-describedby="basic-addon1" />
		</div>
		<div class="input-group mb-3">
			<input type="number" class="form-control" name="ra" placeholder="RA do aluno" aria-label="RA do aluno"
				aria-describedby="basic-addon1" />
		</div>
		<button type="button" class="btn btn-outline-warning cad" disabled>
			Cadastrar
		</button>
		<button type="button" class="btn btn-outline-warning alt" disabled>
			Alterar
		</button>
		<div class="alert-box">
			<div class="alert" role="alert" style="display: none;"></div>
		</div>
	</div>
	
</body>

</html>